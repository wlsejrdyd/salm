<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head('회원가입')}"></head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center py-12">
    <div class="max-w-md w-full mx-4">
        <div class="text-center mb-8">
            <a href="/" class="text-3xl font-bold text-emerald-500">SALM</a>
        </div>

        <div class="bg-white rounded-2xl shadow-sm p-8">
            <h1 class="text-2xl font-bold text-gray-900 mb-6">회원가입</h1>

            <div th:if="${error}" class="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm" th:text="${error}"></div>

            <form th:action="@{/signup}" method="post" th:object="${request}">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">아이디</label>
                    <div class="flex space-x-2">
                        <input type="text" th:field="*{username}" id="username" required
                               class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
                               placeholder="영문, 숫자 4~20자">
                        <button type="button" onclick="checkUsername()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm whitespace-nowrap">중복확인</button>
                    </div>
                    <p id="usernameMsg" class="mt-1 text-sm"></p>
                    <p th:if="${#fields.hasErrors('username')}" th:errors="*{username}" class="mt-1 text-sm text-red-500"></p>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">이메일</label>
                    <input type="email" th:field="*{email}" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
                           placeholder="example@email.com">
                    <p th:if="${#fields.hasErrors('email')}" th:errors="*{email}" class="mt-1 text-sm text-red-500"></p>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">닉네임</label>
                    <input type="text" th:field="*{nickname}" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
                           placeholder="2~20자">
                    <p th:if="${#fields.hasErrors('nickname')}" th:errors="*{nickname}" class="mt-1 text-sm text-red-500"></p>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">비밀번호</label>
                    <input type="password" th:field="*{password}" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
                           placeholder="8자 이상">
                    <p th:if="${#fields.hasErrors('password')}" th:errors="*{password}" class="mt-1 text-sm text-red-500"></p>
                </div>

                <button type="submit" class="w-full bg-emerald-500 text-white py-3 rounded-lg font-medium hover:bg-emerald-600 transition">
                    가입하기
                </button>
            </form>

            <p class="mt-6 text-center text-gray-500 text-sm">
                이미 계정이 있으신가요? <a href="/login" class="text-emerald-500 hover:text-emerald-600">로그인</a>
            </p>
        </div>
    </div>

    <script>
        async function checkUsername() {
            const val = document.getElementById('username').value;
            if (!val || val.length < 4) {
                showMsg('usernameMsg', '4자 이상 입력해주세요', false);
                return;
            }
            const res = await fetch('/api/auth/check/username?value=' + val);
            const data = await res.json();
            showMsg('usernameMsg', data.data ? '사용 가능한 아이디입니다' : '이미 사용 중인 아이디입니다', data.data);
        }

        function showMsg(id, msg, ok) {
            const el = document.getElementById(id);
            el.textContent = msg;
            el.className = 'mt-1 text-sm ' + (ok ? 'text-green-500' : 'text-red-500');
        }
    </script>
</body>
</html>
