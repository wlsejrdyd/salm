<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head('ë‚´ ì½”ë””')}"></head>
<body class="bg-gray-50 min-h-screen">
    <header th:replace="~{fragments/header :: header}"></header>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <h1 class="text-2xl font-bold text-gray-900 mb-6">ğŸ‘” ë‚´ ì½”ë”” ë§Œë“¤ê¸°</h1>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- ì„ íƒí•œ ì½”ë”” ë¯¸ë¦¬ë³´ê¸° -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-2xl p-6 sticky top-24">
                    <h3 class="font-bold text-gray-900 mb-4">ì„ íƒí•œ ì½”ë””</h3>
                    
                    <div id="selectedOutfit" class="space-y-3">
                        <!-- ì•„ìš°í„° -->
                        <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg" id="selected-outer">
                            <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center text-2xl">ğŸ§¥</div>
                            <div>
                                <p class="text-xs text-gray-500">ì•„ìš°í„°</p>
                                <p class="text-gray-400" id="name-outer">ì„ íƒ ì•ˆí•¨</p>
                            </div>
                        </div>
                        <!-- ìƒì˜ -->
                        <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg" id="selected-tops">
                            <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center text-2xl">ğŸ‘•</div>
                            <div>
                                <p class="text-xs text-gray-500">ìƒì˜</p>
                                <p class="text-gray-400" id="name-tops">ì„ íƒ ì•ˆí•¨</p>
                            </div>
                        </div>
                        <!-- í•˜ì˜ -->
                        <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg" id="selected-bottoms">
                            <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center text-2xl">ğŸ‘–</div>
                            <div>
                                <p class="text-xs text-gray-500">í•˜ì˜</p>
                                <p class="text-gray-400" id="name-bottoms">ì„ íƒ ì•ˆí•¨</p>
                            </div>
                        </div>
                        <!-- ì‹ ë°œ -->
                        <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg" id="selected-shoes">
                            <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center text-2xl">ğŸ‘Ÿ</div>
                            <div>
                                <p class="text-xs text-gray-500">ì‹ ë°œ</p>
                                <p class="text-gray-400" id="name-shoes">ì„ íƒ ì•ˆí•¨</p>
                            </div>
                        </div>
                        <!-- ì•…ì„¸ì„œë¦¬ -->
                        <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg" id="selected-accessories">
                            <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center text-2xl">ğŸ’</div>
                            <div>
                                <p class="text-xs text-gray-500">ì•…ì„¸ì„œë¦¬</p>
                                <p class="text-gray-400" id="name-accessories">ì„ íƒ ì•ˆí•¨</p>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 flex space-x-2">
                        <button onclick="clearAll()" class="flex-1 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">ì´ˆê¸°í™”</button>
                        <button onclick="saveOutfit()" class="flex-1 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600">ì €ì¥</button>
                    </div>
                </div>
            </div>

            <!-- ì˜· ì„ íƒ ì˜ì—­ -->
            <div class="lg:col-span-2">
                <!-- ì¹´í…Œê³ ë¦¬ í•„í„° -->
                <div class="flex flex-wrap gap-2 mb-6">
                    <button onclick="filterCategory('all')" data-cat="all"
                            class="cat-btn px-4 py-2 bg-emerald-500 text-white rounded-full">
                        ì „ì²´
                    </button>
                    <button onclick="filterCategory('outer')" data-cat="outer"
                            class="cat-btn px-4 py-2 bg-white text-gray-700 rounded-full border hover:bg-emerald-50">
                        ğŸ§¥ ì•„ìš°í„°
                    </button>
                    <button onclick="filterCategory('tops')" data-cat="tops"
                            class="cat-btn px-4 py-2 bg-white text-gray-700 rounded-full border hover:bg-emerald-50">
                        ğŸ‘• ìƒì˜
                    </button>
                    <button onclick="filterCategory('bottoms')" data-cat="bottoms"
                            class="cat-btn px-4 py-2 bg-white text-gray-700 rounded-full border hover:bg-emerald-50">
                        ğŸ‘– í•˜ì˜
                    </button>
                    <button onclick="filterCategory('shoes')" data-cat="shoes"
                            class="cat-btn px-4 py-2 bg-white text-gray-700 rounded-full border hover:bg-emerald-50">
                        ğŸ‘Ÿ ì‹ ë°œ
                    </button>
                    <button onclick="filterCategory('accessories')" data-cat="accessories"
                            class="cat-btn px-4 py-2 bg-white text-gray-700 rounded-full border hover:bg-emerald-50">
                        ğŸ’ ì•…ì„¸ì„œë¦¬
                    </button>
                </div>

                <!-- ì˜· ëª©ë¡ -->
                <div th:if="${clothes.content.isEmpty()}" class="bg-white rounded-xl p-12 text-center">
                    <p class="text-4xl mb-4">ğŸ‘•</p>
                    <p class="text-gray-500">ë“±ë¡ëœ ì˜·ì´ ì—†ì–´ìš”</p>
                    <a href="/closet/add" class="inline-block mt-4 text-emerald-500 hover:underline">ì˜· ë“±ë¡í•˜ëŸ¬ ê°€ê¸°</a>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="clothGrid">
                    <div th:each="cloth : ${clothes.content}" 
                         th:data-parent="${cloth.parentType}"
                         th:data-id="${cloth.id}"
                         th:data-image="${cloth.imagePath}"
                         th:data-name="${cloth.name}"
                         class="cloth-item bg-white rounded-xl overflow-hidden shadow-sm cursor-pointer group hover:shadow-lg transition"
                         onclick="selectCloth(this)">
                        <div class="aspect-square bg-gray-100 relative">
                            <img th:if="${cloth.imagePath}" th:src="${cloth.imagePath}" 
                                 class="w-full h-full object-cover" alt="">
                            <div th:unless="${cloth.imagePath}" 
                                 class="w-full h-full flex items-center justify-center text-3xl text-gray-300">ğŸ‘•</div>
                            <!-- ì„ íƒ ì²´í¬ -->
                            <div class="check-mark hidden absolute top-2 right-2 w-6 h-6 bg-emerald-500 rounded-full flex items-center justify-center">
                                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                                </svg>
                            </div>
                            <!-- ì¹´í…Œê³ ë¦¬ ë±ƒì§€ -->
                            <span class="absolute bottom-2 left-2 px-2 py-1 bg-black/50 text-white text-xs rounded-full"
                                  th:text="${cloth.categoryName}">íŒ¨ë”©</span>
                        </div>
                        <div class="p-3">
                            <p class="font-medium text-gray-900 truncate text-sm" th:text="${cloth.name}">ì˜· ì´ë¦„</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer th:replace="~{fragments/footer :: footer}"></footer>

    <style>
        .cat-btn.active {
            background-color: #10b981;
            color: white;
            border-color: #10b981;
        }
        .cloth-item.selected {
            ring: 3px;
            ring-color: #10b981;
            box-shadow: 0 0 0 3px #10b981;
        }
        .cloth-item.selected .check-mark {
            display: flex;
        }
    </style>

    <script>
        const selected = {}; // { outer: {id, image, name}, tops: {...}, ... }
        const icons = { outer: 'ğŸ§¥', tops: 'ğŸ‘•', bottoms: 'ğŸ‘–', shoes: 'ğŸ‘Ÿ', accessories: 'ğŸ’' };

        function filterCategory(cat) {
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼
            document.querySelectorAll('.cat-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-emerald-500', 'text-white');
                btn.classList.add('bg-white', 'text-gray-700', 'border');
            });
            const activeBtn = document.querySelector(`.cat-btn[data-cat="${cat}"]`);
            activeBtn.classList.add('active', 'bg-emerald-500', 'text-white');
            activeBtn.classList.remove('bg-white', 'text-gray-700', 'border');

            // ì˜· í•„í„°ë§
            document.querySelectorAll('.cloth-item').forEach(item => {
                if (cat === 'all' || item.dataset.parent === cat) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function selectCloth(el) {
            const parentType = el.dataset.parent;
            const id = el.dataset.id;
            const image = el.dataset.image;
            const name = el.dataset.name;

            // ê°™ì€ ì¹´í…Œê³ ë¦¬ì˜ ì´ì „ ì„ íƒ í•´ì œ
            if (selected[parentType]) {
                const prevEl = document.querySelector(`.cloth-item[data-id="${selected[parentType].id}"]`);
                if (prevEl) prevEl.classList.remove('selected');
            }

            // ê°™ì€ ê±° ë‹¤ì‹œ í´ë¦­í•˜ë©´ í•´ì œ
            if (selected[parentType]?.id === id) {
                delete selected[parentType];
                el.classList.remove('selected');
            } else {
                // ìƒˆë¡œ ì„ íƒ
                selected[parentType] = { id, image, name };
                el.classList.add('selected');
            }

            updatePreview();
        }

        function updatePreview() {
            const types = ['outer', 'tops', 'bottoms', 'shoes', 'accessories'];
            
            types.forEach(type => {
                const container = document.getElementById(`selected-${type}`);
                const nameEl = document.getElementById(`name-${type}`);
                const imgContainer = container.querySelector('div:first-child');

                if (selected[type]) {
                    if (selected[type].image) {
                        imgContainer.innerHTML = `<img src="${selected[type].image}" class="w-full h-full object-cover rounded-lg">`;
                    }
                    nameEl.textContent = selected[type].name;
                    nameEl.classList.remove('text-gray-400');
                    nameEl.classList.add('text-gray-900', 'font-medium');
                } else {
                    imgContainer.innerHTML = `<span class="text-2xl">${icons[type]}</span>`;
                    imgContainer.className = 'w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center text-2xl';
                    nameEl.textContent = 'ì„ íƒ ì•ˆí•¨';
                    nameEl.classList.add('text-gray-400');
                    nameEl.classList.remove('text-gray-900', 'font-medium');
                }
            });
        }

        function clearAll() {
            Object.keys(selected).forEach(key => delete selected[key]);
            document.querySelectorAll('.cloth-item.selected').forEach(el => el.classList.remove('selected'));
            updatePreview();
        }

        function saveOutfit() {
            const count = Object.keys(selected).length;
            if (count === 0) {
                alert('ì˜·ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
                return;
            }
            alert(`${count}ê°œ ì•„ì´í…œ ì„ íƒë¨!\nì½”ë”” ì €ì¥ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.`);
        }
    </script>
</body>
</html>
