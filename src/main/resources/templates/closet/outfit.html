<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head('ì˜¤ëŠ˜ì˜ ì½”ë””')}"></head>
<body class="bg-gray-50 min-h-screen">
    <header th:replace="~{fragments/header :: header}"></header>

    <main class="max-w-4xl mx-auto px-4 py-8">
        <!-- ë‚ ì”¨ ì •ë³´ -->
        <div class="bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-2xl p-6 mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-blue-100">ì˜¤ëŠ˜ì˜ ë‚ ì”¨</p>
                    <h2 class="text-5xl font-bold" th:text="${weather.temperature} + 'Â°'">5Â°</h2>
                    <p class="text-blue-100 mt-1" th:text="${weather.city} + ' Â· ì²´ê° ' + ${weather.feelsLike} + 'Â°'">ì„œìš¸ Â· ì²´ê° 2Â°</p>
                </div>
                <div class="text-right">
                    <p class="text-7xl mb-2" id="weatherIcon">ğŸŒ¤ï¸</p>
                </div>
            </div>
            <p class="mt-4 text-lg" th:text="${weather.recommendation}">ì¶”ì²œ ë©”ì‹œì§€</p>
        </div>

        <!-- ì½”ë”” ê²°ê³¼ -->
        <div class="bg-white rounded-2xl p-6 mb-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold">ğŸ² ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì½”ë””</h2>
                <button onclick="loadRandomOutfit()" class="px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600">
                    ë‹¤ì‹œ ì¶”ì²œ
                </button>
            </div>

            <!-- ì•„ë°”íƒ€ + ì˜· ë ˆì´ì–´ -->
            <div class="flex flex-col md:flex-row gap-8">
                <!-- ì•„ë°”íƒ€ ì˜ì—­ -->
                <div class="flex-1">
                    <div class="aspect-[3/4] bg-gradient-to-b from-gray-100 to-gray-50 rounded-2xl relative overflow-hidden" id="outfitCanvas">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="text-center text-gray-400" id="emptyState">
                                <p class="text-6xl mb-4">ğŸ‘¤</p>
                                <p>ì˜·ì„ ë“±ë¡í•˜ê³  ì˜¨ë„ë¥¼ ì„¤ì •í•˜ë©´</p>
                                <p>ìë™ìœ¼ë¡œ ì½”ë””ë¥¼ ì¶”ì²œí•´ë“œë ¤ìš”!</p>
                            </div>
                        </div>
                        
                        <!-- ì˜· ë ˆì´ì–´ë“¤ (ìœ„ì—ì„œë¶€í„°: ì•„ìš°í„° â†’ ìƒì˜ â†’ í•˜ì˜ â†’ ì‹ ë°œ) -->
                        <div id="clothLayers" class="absolute inset-0 flex flex-col items-center justify-center p-4">
                            <div id="layer-outer" class="outfit-layer" style="height: 35%; width: 80%;"></div>
                            <div id="layer-tops" class="outfit-layer" style="height: 25%; width: 70%;"></div>
                            <div id="layer-bottoms" class="outfit-layer" style="height: 30%; width: 60%;"></div>
                            <div id="layer-shoes" class="outfit-layer" style="height: 10%; width: 40%;"></div>
                        </div>
                    </div>
                </div>

                <!-- ì„ íƒëœ ì˜· ëª©ë¡ -->
                <div class="md:w-64 space-y-4" id="outfitList">
                    <div class="text-center text-gray-400 py-8">
                        <p>ì¶”ì²œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì˜·ì´ ë¶€ì¡±í•  ë•Œ ì•ˆë‚´ -->
        <div id="noClothesWarning" class="hidden bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-6">
            <p class="text-yellow-800">
                âš ï¸ í˜„ì¬ ì˜¨ë„(<span id="currentTemp"></span>Â°C)ì— ë§ëŠ” ì˜·ì´ ë¶€ì¡±í•´ìš”!
                <a href="/closet/add" class="text-yellow-600 underline">ì˜·ì„ ë“±ë¡</a>í•˜ê³  ì˜¨ë„ë¥¼ ì„¤ì •í•´ë³´ì„¸ìš”.
            </p>
        </div>
    </main>

    <footer th:replace="~{fragments/footer :: footer}"></footer>

    <style>
        .outfit-layer {
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .outfit-layer img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
    </style>

    <script th:inline="javascript">
        const currentTemp = [[${weather.temperature}]];
        document.getElementById('currentTemp').textContent = currentTemp;

        // í˜ì´ì§€ ë¡œë“œì‹œ ìë™ ì¶”ì²œ
        loadRandomOutfit();

        async function loadRandomOutfit() {
            try {
                const res = await fetch(`/api/closet/outfit/random?temperature=${currentTemp}`);
                const data = await res.json();

                if (!data.success) {
                    showError('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    return;
                }

                const outfit = data.data;
                const categories = ['outer', 'tops', 'bottoms', 'shoes'];
                const categoryNames = { outer: 'ì•„ìš°í„°', tops: 'ìƒì˜', bottoms: 'í•˜ì˜', shoes: 'ì‹ ë°œ' };
                const categoryIcons = { outer: 'ğŸ§¥', tops: 'ğŸ‘•', bottoms: 'ğŸ‘–', shoes: 'ğŸ‘Ÿ' };

                let hasAny = false;
                let listHtml = '';

                categories.forEach(cat => {
                    const layer = document.getElementById(`layer-${cat}`);
                    const cloth = outfit[cat];

                    if (cloth && cloth.imagePath) {
                        hasAny = true;
                        layer.innerHTML = `<img src="${cloth.imagePath}" alt="${cloth.name}">`;
                        listHtml += `
                            <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                <div class="w-16 h-16 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0">
                                    <img src="${cloth.imagePath}" class="w-full h-full object-cover">
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-xs text-gray-500">${categoryIcons[cat]} ${categoryNames[cat]}</p>
                                    <p class="font-medium truncate">${cloth.name}</p>
                                </div>
                            </div>
                        `;
                    } else {
                        layer.innerHTML = `<div class="text-4xl opacity-30">${categoryIcons[cat]}</div>`;
                        listHtml += `
                            <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg opacity-50">
                                <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center text-2xl">
                                    ${categoryIcons[cat]}
                                </div>
                                <div class="flex-1">
                                    <p class="text-xs text-gray-500">${categoryNames[cat]}</p>
                                    <p class="text-gray-400">ì—†ìŒ</p>
                                </div>
                            </div>
                        `;
                    }
                });

                document.getElementById('outfitList').innerHTML = listHtml;
                document.getElementById('emptyState').style.display = hasAny ? 'none' : 'block';
                document.getElementById('noClothesWarning').classList.toggle('hidden', hasAny);

            } catch (e) {
                console.error(e);
                showError('ì½”ë””ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function showError(msg) {
            document.getElementById('outfitList').innerHTML = `<p class="text-red-500 text-center py-4">${msg}</p>`;
        }
    </script>
</body>
</html>
